# F5-TTS Fine-Tuning Utility üöÄ

**`finetune_tts.py`** ‚Äî –µ–¥–∏–Ω—ã–π CLI-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:

1. –ì–æ—Ç–æ–≤–∏—Ç –¥–∞—Ç–∞—Å–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ **`csv + wavs` ‚Üí HuggingFace Arrow**  
   (–≤–∫–ª—é—á–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –≤ –ø–∏–Ω—å–∏–Ω—å –∏ –ø–æ–¥—Å—á—ë—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π).
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç **—Ç–æ–Ω–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É (fine-tune)** –º–æ–¥–µ–ª–∏ F5-TTS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π multi-GPU –∏ fp16 —á–µ—Ä–µ–∑ `accelerate`.

> –°–∫—Ä–∏–ø—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è, —á—Ç–æ–±—ã *¬´—Å–∫–∞—á–∞–ª –∏ –∑–∞–ø—É—Å—Ç–∏–ª¬ª* ‚Äî –±–µ–∑ —Ä—É—á–Ω–æ–π –ø—Ä–∞–≤–∫–∏ –ø—É—Ç–µ–π –∏ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è |
|-------|--------|
| Python | 3.9 ‚Äì 3.12 |
| PyTorch | >= 2.2 (CUDA 11.8+) |
| `accelerate` | >= 0.28 |
| `datasets`   | >= 3.8 |
| `torchaudio` | —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –≤–µ—Ä—Å–∏–µ–π PyTorch |
| `f5-tts`     | –∞–∫—Ç—É–∞–ª—å–Ω–∞—è dev-–≤–µ—Ç–∫–∞ |
| `ffmpeg/ffprobe` | –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥—Å—á—ë—Ç–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π |

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ pip:

```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
pip install accelerate datasets tqdm f5-tts
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

```bash
python finetune_tts.py prepare \
    --inp_dir /path/to/your/csv_wavs \
    --vocab_path /path/to/pretrained/vocab.txt
```

### 2. –ó–∞–ø—É—Å–∫ fine-tune

```bash
python finetune_tts.py train \
    --prepared_dir ./data_prepared \
    --ckpt /path/to/base_model.pt
```

### 3. –í—Å—ë –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)

```bash
python finetune_tts.py
```

## üõ†Ô∏è CLI-–∞—Ä–≥—É–º–µ–Ω—Ç—ã

| –ü–æ–¥–∫–æ–º–∞–Ω–¥–∞ | –ê—Ä–≥—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------|--------------|
| `prepare` | `--inp_dir` | –ü–∞–ø–∫–∞ —Å `metadata.csv` –∏ `wavs/` | ‚Äî |
|           | `--out_dir` | –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å Arrow-–¥–∞—Ç–∞—Å–µ—Ç | `data_prepared/` |
|           | `--vocab_path` | `vocab.txt` –æ—Ç –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª–∏ | ‚Äî |
|           | `--pretrain` | –§–ª–∞–≥: –≥–æ—Ç–æ–≤–∏–º –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è **pre-training** | `False` |
| `train`   | `--prepared_dir` | –ü–∞–ø–∫–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –Ω–∞ —à–∞–≥–µ *prepare* | `data_prepared/` |
|           | `--ckpt` | –ë–∞–∑–æ–≤—ã–π .pt —á–µ–∫–ø–æ–π–Ω—Ç F5-TTS | ‚Äî |
|           | `--output_ckpts` | –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–æ–≤—ã–µ —á–µ–∫–ø–æ–π–Ω—Ç—ã | `ckpts/` |
|           | `--epochs` | –ß–∏—Å–ª–æ —ç–ø–æ—Ö | `100` |
|           | `--lr` | Learning rate | `1e-5` |
|           | `--batch_size_frames` | Batch-size –≤ *—Ñ—Ä–µ–π–º–∞—Ö* | `4000` |
| `all`     | –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã `prepare` + `train` | | |

## üìÇ –ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è

| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|------------|------------|
| `data_prepared/` | `raw.arrow`, `duration.json`, `vocab.txt` |
| `ckpts/` | `model_XXXXX.pt`, TensorBoard –ª–æ–≥-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |

## üîç –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞

1. **Prepare**  
   *–ü–µ—Ä–µ–Ω–æ—Å* CSV-–¥–∞—Ç–∞—Å–µ—Ç–∞ –≤ Arrow —Å–æ –≤—Å—Ç–∞–≤–∫–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, –ø–∏–Ω—å–∏–Ω—å ‚Üí –∏–Ω–¥–µ–∫—Å–æ–≤, –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `vocab.txt`.
2. **Train**  
   *Accelerate* –ø–æ–¥–Ω–∏–º–∞–µ—Ç DDP –∏–ª–∏ single-GPU, –≥—Ä—É–∑–∏—Ç –±–∞–∑–æ–≤—ã–π —á–µ–∫–ø–æ–π–Ω—Ç, –ª–æ–≥–∏—Ä—É–µ—Ç –≤ TensorBoard / wandb, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—ã–µ `2000` –∞–ø–¥–µ–π—Ç–æ–≤.
